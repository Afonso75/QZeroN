<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Desbloquear Perfil - QZero</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        button:hover {
            background: #45a049;
        }
        .danger {
            background: #f44336;
        }
        .danger:hover {
            background: #da190b;
        }
        #status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            display: none;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        pre {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”§ Desbloquear Perfil Pendente</h1>
        
        <p>Use esta ferramenta para desbloquear perfis empresariais que ficaram presos em "pending_payment".</p>
        
        <button onclick="checkProfiles()">1. Ver Perfis Pendentes</button>
        <button onclick="activateProfile()">2. Ativar Perfil</button>
        <button onclick="clearAll()" class="danger">3. Limpar TUDO e RecomeÃ§ar</button>
        
        <div id="status"></div>
    </div>

    <script>
        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = type;
            status.style.display = 'block';
        }

        function checkProfiles() {
            try {
                const profilesJson = localStorage.getItem('company_profiles');
                
                if (!profilesJson) {
                    showStatus('âŒ Nenhum perfil encontrado no localStorage', 'error');
                    return;
                }
                
                const profiles = JSON.parse(profilesJson);
                const pendingProfiles = profiles.filter(p => p.status === 'pending_payment');
                
                if (pendingProfiles.length === 0) {
                    showStatus('âœ… NÃ£o hÃ¡ perfis pendentes!', 'success');
                    return;
                }
                
                const message = `ðŸ“‹ ${pendingProfiles.length} perfil(is) pendente(s):\n\n` +
                    pendingProfiles.map(p => `â€¢ ${p.companyName} (${p.companyEmail})\n  ID: ${p.id}\n  Status: ${p.status}`).join('\n\n');
                
                showStatus(message, 'info');
                
            } catch (error) {
                showStatus(`âŒ Erro: ${error.message}`, 'error');
            }
        }

        function activateProfile() {
            try {
                console.log('ðŸ”§ Iniciando ativaÃ§Ã£o de perfis pendentes...');
                
                // 1. Buscar perfis
                const profilesJson = localStorage.getItem('company_profiles');
                if (!profilesJson) {
                    showStatus('âŒ Nenhum perfil encontrado', 'error');
                    return;
                }
                
                const profiles = JSON.parse(profilesJson);
                const pendingProfiles = profiles.filter(p => p.status === 'pending_payment');
                
                if (pendingProfiles.length === 0) {
                    showStatus('âœ… Nenhum perfil pendente para ativar', 'success');
                    return;
                }
                
                console.log('ðŸ“‹ Perfis pendentes:', pendingProfiles.map(p => p.companyName));
                
                // 2. ATIVAR TODOS os perfis pendentes
                let activated = 0;
                pendingProfiles.forEach(profile => {
                    profile.status = 'active';
                    profile.subscriptionStatus = 'active';
                    profile.featuresEnabled = true;
                    activated++;
                    console.log('âœ… Perfil ativado:', profile.companyName);
                });
                
                // 3. Salvar perfis atualizados
                localStorage.setItem('company_profiles', JSON.stringify(profiles));
                console.log('ðŸ’¾ Perfis salvos no localStorage');
                
                // 4. Atualizar usuÃ¡rio atual
                const userJson = localStorage.getItem('mock_user');
                if (userJson) {
                    const user = JSON.parse(userJson);
                    user.has_business_subscription = true;
                    user.business_profile_completed = true;
                    user.account_type = 'empresa';
                    user.onboarding_completed = true;
                    localStorage.setItem('mock_user', JSON.stringify(user));
                    console.log('ðŸ‘¤ UsuÃ¡rio atualizado');
                }
                
                showStatus(`âœ… ${activated} perfil(is) ativado(s) com sucesso!\n\nRecarregando em 2 segundos...`, 'success');
                
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);
                
            } catch (error) {
                console.error('âŒ Erro:', error);
                showStatus(`âŒ Erro: ${error.message}`, 'error');
            }
        }

        function clearAll() {
            if (!confirm('âš ï¸ ATENÃ‡ÃƒO!\n\nIsso vai APAGAR TODOS OS DADOS e criar uma nova conta do zero.\n\nTem certeza?')) {
                return;
            }
            
            try {
                console.log('ðŸ§¹ Limpando TODOS os dados...');
                localStorage.clear();
                console.log('âœ… Dados limpos!');
                
                showStatus('âœ… Todos os dados foram limpos!\n\nRecarregando em 2 segundos...', 'success');
                
                setTimeout(() => {
                    window.location.href = '/';
                }, 2000);
                
            } catch (error) {
                showStatus(`âŒ Erro: ${error.message}`, 'error');
            }
        }
        
        // Executar verificaÃ§Ã£o automÃ¡tica ao carregar a pÃ¡gina
        window.addEventListener('load', () => {
            checkProfiles();
        });
    </script>
</body>
</html>
